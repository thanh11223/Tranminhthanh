<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dự đoán loài hoa Iris — nhập 0–4 tham số</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f172a;--card:#111827;--muted:#94a3b8;--accent:#22d3ee;--white:#e5e7eb}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(135deg,#0b1022,#121a33 40%,#0b1022);color:var(--white)}
    .container{max-width:880px;margin:40px auto;padding:24px}
    .card{background:rgba(17,24,39,.7);backdrop-filter: blur(8px);border:1px solid rgba(255,255,255,.06);border-radius:20px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .grid{display:grid;gap:16px} @media(min-width:768px){.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}
    h1{font-size:clamp(22px,3.5vw,34px);margin:0 0 8px;line-height:1.1}
    .sub{color:var(--muted);margin-bottom:20px}
    label{display:block;font-weight:600;margin-bottom:6px}
    input[type="number"]{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0b1222;color:var(--white);outline:none}
    input[type="number"]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(34,211,238,.2)}
    .rowwrap{display:flex;flex-wrap:wrap;gap:10px}
    .btn{appearance:none;border:none;background:linear-gradient(135deg,#22d3ee,#3b82f6);color:white;padding:12px 16px;border-radius:14px;font-weight:700;cursor:pointer;box-shadow:0 8px 18px rgba(59,130,246,.35);transition:transform .06s ease}
    .btn:active{transform:translateY(1px)} .btn.ghost{background:transparent;border:1px dashed rgba(255,255,255,.18);box-shadow:none;color:var(--muted)}
    .out{margin-top:20px;border-top:1px dashed rgba(255,255,255,.12);padding-top:18px}
    .species{font-size:clamp(20px,3vw,28px);font-weight:800;letter-spacing:.3px}
    .prob{margin-top:8px;display:grid;gap:8px}
    progress{width:100%;height:12px;border:0;border-radius:999px;overflow:hidden}
    progress::-webkit-progress-bar{background:#0b1222} progress::-webkit-progress-value{background:linear-gradient(90deg,#22d3ee,#3b82f6)}
    .footer{margin-top:24px;color:var(--muted);font-size:12px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.1);color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Ứng dụng web: Dự đoán <span style="color:var(--accent)">loài hoa</span> (Iris)</h1>
      <div class="sub">Nhập từ <strong>0–4</strong> tham số (cm). Càng nhập đủ, kết quả càng chính xác. Backend: Flask + KNN (scikit-learn).</div>
      <div class="grid grid-cols-2">
        <div>
          <label>Sepal length</label><input id="sepal_len" type="number" step="0.1" placeholder="vd: 5.1" />
          <label>Sepal width</label><input id="sepal_wid" type="number" step="0.1" placeholder="vd: 3.5" />
          <label>Petal length</label><input id="petal_len" type="number" step="0.1" placeholder="vd: 1.4" />
          <label>Petal width</label><input id="petal_wid" type="number" step="0.1" placeholder="vd: 0.2" />
        </div>
        <div>
          <div class="rowwrap">
            <button class="btn" id="predictBtn">Dự đoán</button>
            <button class="btn ghost" id="clearBtn">Xoá nhập</button>
            <button class="btn ghost" id="example1">Ví dụ Setosa</button>
            <button class="btn ghost" id="example2">Ví dụ Versicolor</button>
            <button class="btn ghost" id="example3">Ví dụ Virginica</button>
          </div>
          <div class="pill" style="margin-top:10px">API: <code>POST /predict</code> (JSON)</div>
        </div>
      </div>

      <div class="out" id="output" hidden>
        <div class="species" id="predLabel"></div>
        <div class="prob" id="probBox"></div>
      </div>

      <div class="footer">Bộ dữ liệu: Iris (Fisher, 1936). Mô hình: KNN (k=3) + SimpleImputer.</div>
    </div>
  </div>

  <script>
    const ids = ["sepal_len","sepal_wid","petal_len","petal_wid"];
    function readInputs(){
      return {
        sepal_len: val("sepal_len"),
        sepal_wid: val("sepal_wid"),
        petal_len: val("petal_len"),
        petal_wid: val("petal_wid"),
      };
    }
    function val(id){
      const v = document.getElementById(id).value.trim();
      return v === '' ? null : Number(v);
    }
    async function predict(){
      const res = await fetch("/predict",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify(readInputs())
      });
      const data = await res.json();
      const out = document.getElementById('output');
      const label = document.getElementById('predLabel');
      const prob = document.getElementById('probBox');
      if(data.error){
        out.hidden = false;
        label.textContent = "Lỗi: " + data.error;
        prob.innerHTML = "";
        return;
      }
      out.hidden = false;
      label.textContent = "Dự đoán: " + data.species;
      const probs = data.probabilities || {};
      prob.innerHTML = Object.keys(probs).map(k=>{
        const p = probs[k];
        const pc = (p*100).toFixed(1) + "%";
        return `<div>
          <div style="display:flex;justify-content:space-between;margin-bottom:4px">
            <span>${k}</span><strong>${pc}</strong>
          </div>
          <progress max="1" value="${p}"></progress>
        </div>`
      }).join('');
    }
    function fillExample(idx){
      const ex = [
        [5.1,3.5,1.4,0.2],
        [6.0,2.9,4.5,1.5],
        [6.7,3.1,5.6,2.4],
      ][idx];
      ids.forEach((id,i)=>document.getElementById(id).value = ex[i]);
      predict();
    }
    document.getElementById('predictBtn').addEventListener('click', predict);
    document.getElementById('clearBtn').addEventListener('click', ()=>{ ids.forEach(id=>document.getElementById(id).value=''); document.getElementById('output').hidden = true; });
    document.getElementById('example1').addEventListener('click', ()=>fillExample(0));
    document.getElementById('example2').addEventListener('click', ()=>fillExample(1));
    document.getElementById('example3').addEventListener('click', ()=>fillExample(2));
  </script>
</body>
</html>
